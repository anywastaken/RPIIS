# Лабораторная работа 5
 
### Цель: 
 
Освоить командные оболочки shell (для OS семейства Unix) и cmd (для OS семейства MS Windows):
+ изучить основные встроенные команды,
+ научиться писать файлы сценариев,
+ научиться соотносить командные оболочки для разных OS.
+ Освоить командное окружение для OS семейства Unix(утилиты из пакета GNU Core Utilities), и соответствующие им утилиты для OS семейства MS Windows.
### Условия задания
61. Создать файл sh и bat, который выполняет следующее: 
На вход пакетному файлу приходит 2 относительных пути к папкам (как параметры пакетного файла). Если какой-нибудь папки нет, то писать “Данной папки нет - [Заданный_путь]” и завершить выполнение программы. В первой заданной папке должно содержаться некоторое число различных файлов. Всем файлам из данной директории присвоить атрибуты "только чтение", кроме файлов, тип которых *.txt. Перенести во вторую папку файлы с расширением txt.
## Batch файл
- ### Код программы :computer:
```batch
@echo off
chcp 65001
setlocal
if "%~2"=="" (    
    echo Необходимы два аргумента: путь к первой и второй папке.
    exit /b 1
)
set "iz=%~1"
set "v=%~2"
    	
if not exist "%iz%" (
	echo Данной папки нет - %iz%
    	exit /b 1
)
if not exist "%v%" (
	echo Данной папки нет - %v%
    	exit /b 1
)
pushd "%iz%"
for %%F in (*) do (
	if /I "%%~xF"==".txt" (
        echo Перемещение файла %%F в %v%       
        move /Y "%%F" "%v%\"
) else (        
	echo Устанавливаем атрибут "только чтение" для файла %%F
        attrib +r "%%F"   
)
)
popd
echo Выполнение завершено.
endlocal
```
### Пример работы кода
![](im1.png)

### Пояснение кода
Отключает вывод команд в командной строке, что делает вывод более чистым и удобным для пользователя.
```
@echo off
```
Устанавливает кодировку UTF-8, чтобы корректно отображать кириллические символы.
```
chcp 65001
```
Запрашивает у пользователя значения N и M. N указывает интервал между циклами в секундах, а M — общее время работы скрип
```
set /p "N=Введите числовое значение для N (интервал в секундах): "
set /p "M=Введите числовое значение для M (максимальное время работы в секундах): "
```
Инициализирует переменные total_time (счётчик времени работы скрипта) и counter (номер создаваемой папки/файла) со значениями 0 и 1 соответственно.
```
set /a "total_time=0"
set /a "counter=1"
```
Создает первую папку folder_1 в том же каталоге, где находится скрипт.
```
set "current_path=%~dp0folder_%counter%"
mkdir "%current_path%"

```
Пауза на N секунд, затем total_time увеличивается на N, отражая общее время работы.

```
timeout /t %N% >nul
set /a "total_time+=N"
```
Начало основного цикла скрипта. Всё, что следует после этого ярлыка :loop, будет повторяться.
```
:loop
```
Проверяет, не достиг ли скрипт максимального времени работы M. Если total_time больше или равен M, программа переходит к завершению (:end).
```
if %total_time% geq %M% goto :end
```
Устанавливает путь к новому файлу %counter%.txt, который будет создан в текущей папке.
```
set "file_path=%current_path%\%counter%.txt"
```
Записывает в файл file_path строку с текущим общим временем работы скрипта.
```
echo Общее время работы скрипта: %total_time% секунд > "%file_path%"
```
Выводит сообщение в консоль о создании нового файла с его номером counter.
```
echo Новый файл %counter% был создан
```
Увеличивает значение счетчика counter на 1, чтобы следующий цикл создал папку и файл с новым номером.
```
set /a "counter+=1"
```
Обновляет путь current_path, добавляя новую папку folder_<номер>, чтобы каждая следующая папка создавалась внутри предыдущей.
Создает новую вложенную папку.
```
set "current_path=%current_path%\folder_%counter%"
mkdir "%current_path%"
```
Увеличивает total_time на N, затем выполняет паузу на N секунд.
```
set /a "total_time+=N" 
timeout /t %N% >nul
```
Переход к началу основного цикла (:loop), если не достигнут предел по времени.
```
goto :loop
```
Метка конца работы программы. Выполнение скрипта перейдёт к этой строке, когда total_time станет больше или равен M.
```
:end
```
Вычисляет количество созданных папок, уменьшая counter на 1, поскольку counter увеличивается в конце каждого цикла.
```
set /a "total_folders=counter-1"
```
Выводит в консоль сообщение с итоговым количеством созданных папок.
```
echo Скрипт завершил работу. Общее количество созданных папок: %total_folders%
```
Выводит в консоль сообщение с итоговым количеством созданных папок.
```
pause
```
## Bash файл
- ### Код программы :computer:
```bash
#!/bin/bash
if [ "$#" -ne 2 ]; then
    echo "Необходимы два аргумента: путь к первой и второй папке."
    exit 1
fi
iz="$1"
v="$2"

if [ ! -d "$iz" ]; then    
   echo "Данной папки нет - $iz"
   exit 1 
fi
if [ ! -d "$v" ]; then
    echo "Данной папки нет - $v"   
    exit 1
fi

if [ -f "$file" ]; then        
    if [[ "$file" == *.txt ]]; then
           echo "Перемещение файла $(basename "$file") в $v"            
           mv "$file" "$v"
        else            
          echo "Устанавливаем атрибут 'только чтение' для файла $(basename "$file")"
          chmod 444 "$file"        
fi
fi 
done
echo "Выполнение завершено."
```
### Пояснение кода
Указывает, что скрипт должен выполняться с использованием интерпретатора bash.
```
#!/bin/bash
```
Устанавливает кодировку UTF-8 для правильного отображения текста на русском языке.
```
export LANG=en_US.UTF-8
```
Запрашивает у пользователя ввод двух значений: N (интервал в секундах) и M (максимальное время работы в секундах).
```
read -p "Введите числовое значение для N (интервал в секундах): " N
read -p "Введите числовое значение для M (максимальное время работы в секундах): " M
```
Инициализирует переменные total_time (счетчик времени, изначально равный 0) и counter (счетчик созданных папок, начинается с 1).
```
total_time=0
counter=1
```
current_path="$(pwd)/folder_$counter" — создает путь к первой папке, используя текущий каталог (pwd).
mkdir -p "$current_path" — создает папку folder_1 по указанному пути.
```
current_path="$(pwd)/folder_$counter"
mkdir -p "$current_path"
```
Выполняет задержку на N секунд, чтобы ожидание перед первой папкой также соответствовало заданному интервалу.
```
sleep "$N"
```
Увеличивает значение переменной total_time на N, поскольку прошло N секунд с начала работы.
```
((total_time+=N))
```
Начало основного цикла. Выполняется, пока значение total_time меньше M.
```
while (( total_time < M )); do
```
file_path="$current_path/$counter.txt" — задает путь к файлу, который будет создан в текущей папке.
```
   file_path="$current_path/$counter.txt"
```
Выводит сообщение о создании нового файла.
```
    echo "Общее время работы скрипта: $total_time секунд" > "$file_path"
    echo "Новый файл $counter был создан"
```
((counter++)) — увеличивает значение счетчика для следующего файла и папки.
current_path="$current_path/folder_$counter" — обновляет путь к папке, добавляя вложенную директорию.
Добавляет интервал N к total_time, чтобы отразить общее время работы после очередного цикла ожидания.
mkdir -p "$current_path" — создает новую папку внутри предыдущей.

```
((counter++))
current_path="$current_path/folder_$counter"
mkdir -p "$current_path"
((total_time+=N))
sleep "$N"
```
Завершает выполнение цикла while, когда total_time достигает или превышает значение M.
```
done
```
Вычисляет общее количество созданных папок, уменьшая значение counter на 1 (так как последний counter увеличивается после создания последней папки).
Выводит это значение в консоль, чтобы показать общее количество созданных папок.
```
total_folders=$((counter - 1))
echo "Скрипт завершил работу. Общее количество созданных папок: $total_folders"
```
### Выводы: 
 В ходе выполнения лабораторной работы по освоению командных оболочек cmd (для операционных систем семейства MS Windows) и shell (для операционных систем семейства Unix) были получены практические навыки работы с консольными программами и командами в различных операционных системах. 
