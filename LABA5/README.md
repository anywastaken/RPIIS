# Лабораторная работа 5
 
### Цель: 
 
Освоить командные оболочки cmd и shell:
+ изучить основные встроенные команды,
+ научиться писать файлы сценариев,
+ научиться соотносить командные оболочки для разных OS.
+ Освоить командное окружение для OS семейства Unix(утилиты из пакета GNU Core Utilities), и соответствующие им утилиты для OS семейства MS Windows.
### Условия задания
51 Создать файл sh и bat, который выполняет следующее: 
На вход пакетному файлу приходит абсолютный путь к папке (как параметр пакетного файла). Если такой папки нет, то писать “Данной папки нет” и завершить выполнение программы. Если такая папка есть, то в ней и ее подкаталогах найти все файлы txt, взять у каждого из них 5-ю строку файла и записать их файл log.txt в порядке возрастания (по строкам)
## Batch файл
- ### Код программы :computer:
```batch
@echo off
setlocal enabledelayedexpansion
chcp 65001

if "%~1"=="" (
   echo Укажите путь к папке
    exit /b
)

set "folder=%~1"

if not exist "!folder!" (
   echo Данной папки нет
    exit /b
)

> log.txt echo.

for /r "%folder%" %%f in (*.txt) do (
    set "line="
    set /a count=0
    for /f "usebackq tokens=*" %%l in ("%%f") do (
        set /a count+=1
        if !count! equ 5 (
            set "line=%%l"
      echo !line!
    echo !line! >> log.txt
        )
    )
 )

sort log.txt /o log.txt

echo Готово
pause

```
### Пояснение кода
Отключает вывод команд в командной строке, что делает вывод более чистым и удобным для пользователя.
```
@echo off
```
Устанавливает кодировку UTF-8, чтобы корректно отображать кириллические символы.
```
chcp 65001
```
 Эта команда включает отложенную обработку переменных.
```
setlocal enabledelayedexpansion
```
Эта проверка проверяет, был ли передан аргумент при запуске скрипта. "%~1" обращается к первому аргументу командной строки. Если аргумент отсутствует (пустой), команда exit /b завершает выполнение скрипта.
```
if "%~1"=="" (
    echo Укажите путь к папке
    exit /b
)
```
Здесь переменной folder присваивается значение первого аргумента командной строки (путь к папке)
```
set "folder=%~1"

```
Эта проверка определяет, существует ли указанная папка. Если папка не существует, выполнение скрипта завершается.
```
if not exist "!folder!" (
    exit /b
)

```
Эта команда создает или очищает файл log.txt
```
> log.txt echo.
```
Этот цикл проходит по всем .txt файлам в указанной папке и всех её подкаталогах. Переменная %%f будет содержать путь к каждому найденному текстовому файлу.
```
for /r "%folder%" %%f in (*.txt) do (
```
Здесь переменной line присваивается пустое значение, а переменной count — значение 0. 
```
    set "line="
    set /a count=0
```
Этот вложенный цикл читает строки из текущего текстового файла (%%f). Опция usebackq позволяет использовать кавычки для указания имени файла. tokens=* означает, что мы хотим получить всю строку.
```
    for /f "usebackq tokens=*" %%l in ("%%f") do (
```
 Эта команда увеличивает значение переменной count на 1 каждый раз, когда читается новая строка из файла.
```
        set /a count+=1
```
• Здесь проверяется, равен ли счетчик строк (переменная count) 5. Если да, то:

  • Переменной line присваивается значение пятой строки (%%l).

  • Значение переменной line выводится на экран с помощью echo !line!.

  • Значение переменной line добавляется в файл log.txt с помощью echo !line! >> log.txt.
```
        if !count! equ 5 (
            set "line=%%l"
            echo !line!
            echo !line! >> log.txt
        )
)
)
```
Эта команда сортирует содержимое файла log.txt и перезаписывает его отсортированным содержимым.
```
       sort log.txt /o log.txt
```
Выводит сообщение "Готово" в консоль, указывая на завершение выполнения скрипта.
```
echo Готово
```
Эта команда приостанавливает выполнение скрипта и ждет, пока пользователь нажмет любую клавишу.
```
pause
```
## Bash файл
- ### Код программы :computer:
```bash
#!/bin/bash
export LANG=ru_RU.UTF-8
read -p "Введите числовое значение для N (интервал в секундах): " N
read -p "Введите числовое значение для M (максимальное время работы в секундах): " M

total_time=0
counter=1
current_path="$(pwd)/folder_$counter"
mkdir -p "$current_path"

while (( total_time < M )); do
    file_path="$current_path/$counter.txt"
sleep "$N"
 ((total_time += N))
    echo "Общее время работы скрипта: $total_time секунд" > "$file_path"
    echo "Новый файл $counter был создан"

    ((counter++))
    current_path="$current_path/folder_$counter"
    mkdir -p "$current_path"
    
   
    
done

total_folders=$((counter - 1))
echo "Скрипт завершил работу. Общее количество созданных папок: $total_folders"

```
### Пояснение кода
Указывает, что скрипт должен выполняться с использованием интерпретатора bash.
```
#!/bin/bash
```
Устанавливает кодировку UTF-8 для правильного отображения текста на русском языке.
```
export LANG=en_US.UTF-8
```
Запрашивает у пользователя ввод двух значений: N (интервал в секундах) и M (максимальное время работы в секундах).
```
read -p "Введите числовое значение для N (интервал в секундах): " N
read -p "Введите числовое значение для M (максимальное время работы в секундах): " M
```
Инициализирует переменные total_time (счетчик времени, изначально равный 0) и counter (счетчик созданных папок, начинается с 1).
```
total_time=0
counter=1
```
current_path="$(pwd)/folder_$counter" — создает путь к первой папке, используя текущий каталог (pwd).
mkdir -p "$current_path" — создает папку folder_1 по указанному пути.
```
current_path="$(pwd)/folder_$counter"
mkdir -p "$current_path"
```
Выполняет задержку на N секунд, чтобы ожидание перед первой папкой также соответствовало заданному интервалу.
```
sleep "$N"
```
Увеличивает значение переменной total_time на N, поскольку прошло N секунд с начала работы.
```
((total_time+=N))
```
Начало основного цикла. Выполняется, пока значение total_time меньше M.
```
while (( total_time < M )); do
```
file_path="$current_path/$counter.txt" — задает путь к файлу, который будет создан в текущей папке.
```
   file_path="$current_path/$counter.txt"
```
Выводит сообщение о создании нового файла.
```
    echo "Общее время работы скрипта: $total_time секунд" > "$file_path"
    echo "Новый файл $counter был создан"
```
((counter++)) — увеличивает значение счетчика для следующего файла и папки.
current_path="$current_path/folder_$counter" — обновляет путь к папке, добавляя вложенную директорию.
Добавляет интервал N к total_time, чтобы отразить общее время работы после очередного цикла ожидания.
mkdir -p "$current_path" — создает новую папку внутри предыдущей.

```
((counter++))
current_path="$current_path/folder_$counter"
mkdir -p "$current_path"
((total_time+=N))
sleep "$N"
```
Завершает выполнение цикла while, когда total_time достигает или превышает значение M.
```
done
```
Вычисляет общее количество созданных папок, уменьшая значение counter на 1 (так как последний counter увеличивается после создания последней папки).
Выводит это значение в консоль, чтобы показать общее количество созданных папок.
```
total_folders=$((counter - 1))
echo "Скрипт завершил работу. Общее количество созданных папок: $total_folders"
```
### Выводы: 
 В ходе выполнения лабораторной работы по освоению командных оболочек cmd (для операционных систем семейства MS Windows) и shell (для операционных систем семейства Unix) были получены практические навыки работы с консольными программами и командами в различных операционных системах. 
