# Лабораторная работа 5
 
### Цель: 
 
Освоить командные оболочки cmd и shell:
+ изучить основные встроенные команды,
+ научиться писать файлы сценариев,
+ научиться соотносить командные оболочки для разных OS.
+ Освоить командное окружение для OS семейства Unix(утилиты из пакета GNU Core Utilities), и соответствующие им утилиты для OS семейства MS Windows.
### Условия задания
Вариант 33: Создать файл sh и bat, который выполняет следующее: 
На вход файлу подается путь к каталогу(как параметр пакетного файла). Если такой папки нет, то писать “Данной папки нет” и завершить выполнение программы. Если такая папка есть, то в ней и ее подкаталогах считываем размеры файлов в формате “имя_файла размер_файла” и записываем их в новый файл, который является вторым параметром пакетного файла. Отсортировать содержимое в порядке уменьшения размера файлов.
## Batch файл
# Как запустить
+ запустить командную строку (win + r и написать cmd)
+ переидти в директорию, где расположен исполнительный файл
+ запустить исполнительный файл прописав его имя в командной строке
- ### Код программы
```batch
@echo off
chcp 65001 
setlocal enabledelayedexpansion

set /p "directory=Введите путь к директории: "
set /p "file=Введите путь к выходному файлу: "

if not exist "!directory!" (
    echo Директория не найдена.
    exit /b
)
cd %directory%
:rec
for %%f in (*) do (
    echo %%f %%~zf>> %file%
)

for /D %%d in (*) do (
    cd %%d
    call :rec
    cd ..
)

powershell -command "Get-Content %file% | Sort-Object { [int]($_.Split(' ')[-1]) } -Descending | Set-Content %file%

echo Результаты записаны в: %file%

endlocal
```
### Пример
![](cmd.png.png)

### Пояснение кода
Отключает вывод команд в командной строке, что делает вывод более чистым и удобным для пользователя.
```
@echo off
```
Устанавливает кодировку UTF-8, чтобы корректно отображать кириллические символы.
```
chcp 65001
```
Запрашивает у пользователя путь к директории и выходному файлу.
```
set /p "directory=Введите путь к директории: "
set /p "file=Введите путь к выходному файлу: "
```
Проверяет существование указанной директории
```
if not exist "!directory!" (
    echo Директория не найдена.
    exit /b
)
```
Создает функцию rec, которая записывает в выходной файл имя и размер каждого файла и которую можно вызвать с помощью call
```
:rec
for %%f in (*) do (
    echo %%f %%~zf>> %file%
)
```
Цикл который проходит по данной директории и всем ее подкаталогам.

```
for /D %%d in (*) do (
    cd %%d
    call :rec
    cd ..
)
```
Ввиду невозвожности работы команды sort с численными значениями, была задействована сортировка с помощью powershell.
```
powershell -command "Get-Content %file% | Sort-Object { [int]($_.Split(' ')[-1]) } -Descending | Set-Content %file%
```
Считывает исходый файл.
```
Get-Content %file%
```
Делит каждую строку на две части и преобразует вторую часть строки в число, затем сортирует.
```
Sort-Object { [int]($_.Split(' ')[-1]) } -Descending(от большего к меньшему)
```
Записывает в файл отсортированные строки.
```
Set-Content %file%
```
## Shell файл
# Как запустить
+ запустить git bash
+ переидти в директорию, где расположен исполнительный файл
+ сделать файл исполняемым командой chmod +x bash.sh
+ запустить файл командой ./filename.sh
- ### Код
```bash
#!/bin/bash
export LANG=ru_RU.UTF-8

read -p "Введите путь к директории: " directory
read -p "Введите к выводному файлу: " file

if [ ! -d "$directory" ]; then
    echo "Директория не существует."
    exit 1
fi

find "$directory" -type f -exec du -b {} + | sed -E 's|([0-9]+)\s+(.*)/([^/]+)|\3 \1|' > "$file"

sort -k2 -n -r "$file" -o "$file"

echo "Результат будет сохранен в $file."
```
### Пояснение кода
Указывает, что скрипт должен выполняться с использованием интерпретатора bash.
```
#!/bin/bash
```
Устанавливает кодировку UTF-8 для правильного отображения текста на русском языке.
```
export LANG=en_US.UTF-8
```
Запрашивает у пользователя ввод двух значений.
```
read -p "Введите путь к директории: " directory
read -p "Введите к выводному файлу: " file
```
Проверяет существование директории.
```
if [ ! -d "$directory" ]; then
    echo "Директория не существует."
    exit 1
fi
```
Ищет в директории и ее подкаталогах все файлы, для каждого считывает размер и, с помощью регулярного выражения, имя файла.
```
find "$directory" -type f -exec(для каждого) du(считать память) -b(в байтах) {} +(совмещает несколько коман) | sed -E 's|([0-9]+)\s+(.*)/([^/]+)|\3 \1|' > "$file"
```
Сортирует вторую(численную) часть файла и пересохраняет файл.
```
sort -k2 -n(численно) -r(реверс) "$file" -o "$file"
```
### Выводы: 
 В ходе выполнения лабораторной работы обрел практические и теоретические навыки работы с консольными программами и командами в таких ОС как Windows и Linux. 
