# Лабораторная работа №5
## Скрипты

## Цели
* **Освоить командные оболочки shell (для OS семейства Unix) и cmd (для OS семейства MS Windows):**
    - Изучить основные встроенные команды.
    - Научиться писать файлы сценариев.
    - Научиться соотносить командные оболочки для разных OS.


## Задачи
* Познакомиться с консольными программными окружениями OS Windows и OS Linux.
* Получить практические навыки работы в консоли, использования консольных команд.

## Индивидуальное задание
Создать файл `sh` и `bat`, который выполняет следующее:

`Вычислить суммарный объем занимаемой памяти всеми активными процессами операционной системы. Скрипт выводит результаты вычисления в файл: суммарный объем памяти, число активных процессов.`

### Объяснение .bat-скрипта для подсчета памяти активных процессов

Этот `.bat`-скрипт вычисляет суммарный объем памяти, занимаемой всеми активными процессами, и подсчитывает их количество. Результаты сохраняются в файл `system_memory_usage.txt`.

## Подробное объяснение каждой строки

### Код скрипта
```bat
@echo off
setlocal
rem Создание переменных для хранения суммарной памяти и количества процессов
set "total_memory=0"
set "process_count=0"

rem Использование команды tasklist для получения информации о процессах
for /f "skip=3 tokens=5" %%A in ('tasklist') do (
    set /a total_memory+=%%A
    set /a process_count+=1
)

rem Сохранение результатов в файл
set "output_file=system_memory_usage.txt"
echo Суммарный объем памяти (в KB): %total_memory% > "%output_file%"
echo Число активных процессов: %process_count% >> "%output_file%"

echo Результаты сохранены в файл %output_file%
pause
```

### Объяснение строк

#### `@echo off`
Отключает отображение команд в консоли. Это делает вывод скрипта более чистым, отображая только результат его выполнения.

#### `setlocal`
Устанавливает локальную область для переменных. Это означает, что все изменения переменных, выполненные в скрипте, не повлияют на общесистемные переменные.

#### `rem ...`
Комментарий, который не выполняется. Используется для добавления пояснений в код. Например:
```bat
rem Создание переменных для хранения суммарной памяти и количества процессов
```

#### `set "total_memory=0"`
Создает переменную `total_memory` и инициализирует её значением 0. Эта переменная будет хранить общий объем памяти (в KB), используемой всеми процессами.

#### `set "process_count=0"`
Создает переменную `process_count` и инициализирует её значением 0. Эта переменная будет подсчитывать количество активных процессов.

#### `for /f "skip=3 tokens=5" %%A in ('tasklist') do (...)`
Цикл, который обрабатывает строки, возвращаемые командой `tasklist`. Вот как он работает:
- **`tasklist`**: Возвращает список всех активных процессов и объем памяти, используемой каждым процессом.
- **`skip=3`**: Пропускает первые три строки вывода команды, содержащие заголовки таблицы.
- **`tokens=5`**: Берет 5-й столбец, который содержит объем памяти процесса в KB.
- **`%%A`**: Временная переменная, которая хранит значение текущей строки из 5-го столбца.

#### `set /a total_memory+=%%A`
Добавляет значение из текущей строки (объем памяти процесса) к переменной `total_memory`.

#### `set /a process_count+=1`
Увеличивает значение переменной `process_count` на 1. Это подсчитывает количество строк (процессов).

#### `set "output_file=system_memory_usage.txt"`
Создает переменную `output_file` и задает имя выходного файла, куда будут сохранены результаты.

#### `echo Суммарный объем памяти (в KB): %total_memory% > "%output_file%"`
Записывает строку с суммарным объемом памяти в указанный файл. Если файл уже существует, его содержимое перезаписывается.

#### `echo Число активных процессов: %process_count% >> "%output_file%"`
Добавляет строку с количеством процессов в файл. Предыдущее содержимое файла сохраняется, так как используется `>>`.

#### `echo Результаты сохранены в файл %output_file%`
Выводит сообщение в консоль о том, что результаты сохранены в файл.

#### `pause`
Останавливает выполнение скрипта и ждет нажатия любой клавиши, чтобы пользователь мог увидеть сообщение в консоли.

---



# Объяснение .sh-скрипта для подсчета памяти активных процессов

Этот `.sh`-скрипт вычисляет суммарный объем памяти, занимаемой всеми активными процессами, и подсчитывает их количество. Результаты сохраняются в файл `system_memory_usage.txt`.

## Подробное объяснение каждой строки

### Код скрипта
```sh
#!/bin/bash

# Подсчет суммарного объема памяти и числа активных процессов
total_memory=$(ps -eo rss | awk '{sum+=$1} END {print sum}')
process_count=$(ps -e | wc -l)

# Сохранение результатов в файл
output_file="system_memory_usage.txt"
echo "Суммарный объем памяти (в KB): $total_memory" > "$output_file"
echo "Число активных процессов: $process_count" >> "$output_file"

echo "Результаты сохранены в файл $output_file"
```

### Объяснение строк

#### `#!/bin/bash`
Указывает, что скрипт должен выполняться с использованием оболочки Bash. Это первая строка в любом Bash-скрипте.

#### `total_memory=$(ps -eo rss | awk '{sum+=$1} END {print sum}')`
Считает суммарный объем памяти, используемой всеми процессами:
- **`ps -eo rss`**: Выводит список всех процессов и их использование памяти в столбце `RSS` (в KB).
- **`awk '{sum+=$1} END {print sum}'`**: Суммирует значения в первом столбце (память каждого процесса) и выводит результат.
- **`$(...)`**: Позволяет сохранить результат команды в переменной `total_memory`.

#### `process_count=$(ps -e | wc -l)`
Считает общее количество активных процессов:
- **`ps -e`**: Выводит список всех процессов.
- **`wc -l`**: Подсчитывает количество строк (каждая строка соответствует процессу).
- **`$(...)`**: Сохраняет результат в переменной `process_count`.

#### `output_file="system_memory_usage.txt"`
Создает переменную `output_file` с именем выходного файла, куда будут сохранены результаты.

#### `echo "Суммарный объем памяти (в KB): $total_memory" > "$output_file"`
Записывает строку с суммарным объемом памяти в файл. Если файл уже существует, его содержимое перезаписывается.

#### `echo "Число активных процессов: $process_count" >> "$output_file"`
Добавляет строку с количеством процессов в файл. Предыдущее содержимое файла сохраняется, так как используется `>>`.

#### `echo "Результаты сохранены в файл $output_file"`
Выводит сообщение в консоль о том, что результаты сохранены в файл.

---

### Как использовать скрипт
1. Сохраните код в файл, например, `memory_usage.sh`.
2. Сделайте скрипт исполняемым:
   ```bash
   chmod +x memory_usage.sh
   ```
3. Запустите скрипт:
   ```bash
   ./memory_usage.sh
   ```

После выполнения создастся файл `system_memory_usage.txt` с результатами.

---






## Среда разработки

В разработке использовался редактор кода [Visual Studio Code](https://code.visualstudio.com/).


## Основные команды

### Linux (shell)
- `ls` - выводит список файлов и директорий в текущей директории.
- `cd <директория>` - меняет текущую директорию.
- `pwd` - выводит полный путь текущей директории.
- `cp <источник> <назначение>` - копирует файл или директорию.
- `mv <источник> <назначение>` - перемещает или переименовывает файл или директорию.
- `rm <файл>` - удаляет файл.
- `echo <сообщение>` - выводит сообщение на экран.

### Windows (cmd)
- `dir` - выводит список файлов и директорий в текущей директории.
- `cd <директория>` - меняет текущую директорию.
- `echo %CD%` - выводит полный путь текущей директории.
- `copy <источник> <назначение>` - копирует файл или директорию.
- `move <источник> <назначение>` - перемещает или переименовывает файл или директорию.
- `del <файл>` - удаляет файл.
- `echo <сообщение>` - выводит сообщение на экран.





## Итоги
В результате лабораторной работы были созданы `bat` и `sh` файлы. Были освоены командные оболочки `shell` и `cmd`. Все поставленные цели были достигнуты, а задачи выполнены.





#  Гайд по созданию и использованию `.bat` и `.sh` файлов

## Введение

Этот гайд предназначен для изучения создания и использования файлов сценариев в форматах `.bat` для Windows и `.sh` для Unix/Linux. Мы рассмотрим базовый синтаксис, команды и приведем простые примеры.

---



## .bat (Batch-файлы для Windows)

### Основы синтаксиса

1. **Комментарий**: Используется `REM` или `::`.

   - Пример:
     ```bat
     REM Это комментарий
     :: Также комментарий
     ```

2. **Переменные**: Объявляются с помощью команды `SET`.

   - Пример:
     ```bat
     SET VAR=Привет
     ECHO %VAR%
     ```

3. **Ветвления**: Используется `IF`.

   - Пример:
     ```bat
     SET VAR=10
     IF %VAR%==10 (
         ECHO Переменная равна 10
     ) ELSE (
         ECHO Переменная не равна 10
     )
     ```

4. **Циклы**: Используется `FOR`.

   - Пример:
     ```bat
     FOR %%i IN (1 2 3) DO ECHO %%i
     ```

5. **Вызов других файлов**: Используется команда `CALL`.

   - Пример:
     ```bat
     CALL другой_файл.bat
     ```
 
 
### Пример 1: Простой скрипт


```bat
@echo off
REM Этот скрипт выводит текущее время и дату
ECHO Текущая дата: %DATE%
ECHO Текущее время: %TIME%
PAUSE
```

---

## .sh (Shell-файлы для Unix/Linux)

### Основы синтаксиса

1. **Комментарий**: Используется `#`.

   - Пример:
     ```bash
     # Это комментарий
     ```

2. **Переменные**: Объявляются без `=` с пробелами.

   - Пример:
     ```bash
     VAR="Привет"
     echo $VAR
     ```

3. **Ветвления**: Используется `if`.

   - Пример:
     ```bash
     VAR=10
     if [ $VAR -eq 10 ]; then
         echo "Переменная равна 10"
     else
         echo "Переменная не равна 10"
     fi
     ```

4. **Циклы**: Используется `for`.

   - Пример:
     ```bash
     for i in 1 2 3; do
         echo $i
     done
     ```

5. **Вызов других файлов**: Используется `source` или `./`.

   - Пример:
     ```bash
     source другой_файл.sh
     ./другой_файл.sh
     ```

### Пример 1: Простой скрипт

```bash
#!/bin/bash
# Этот скрипт выводит текущее время и дату
echo "Текущая дата: $(date +%D)"
echo "Текущее время: $(date +%T)"
```

---

## Основные команды

### Для Windows

- `ECHO`: Выводит текст на экран.
- `SET`: Создает или изменяет переменные.
- `IF`: Условное выполнение команд.
- `FOR`: Циклы для обработки списков.
- `PAUSE`: Ожидание нажатия клавиши.

### Для Linux

- `echo`: Выводит текст на экран.
- `read`: Чтение данных от пользователя.
- `if`: Условное выполнение команд.
- `for`: Циклы для обработки списков.
- `chmod`: Установка прав на выполнение файла (`chmod +x script.sh`).

---

### Работа с файлами и папками

#### Linux (shell)
- Создание файла: `touch filename.txt`
- Создание папки: `mkdir dirname`
- Перемещение файла: `mv filename.txt /path/to/destination/`
- Копирование файла: `cp filename.txt /path/to/destination/`
- Удаление файла: `rm filename.txt`
- Удаление папки: `rm -r dirname`

#### Windows (cmd)
- Создание файла: `type nul > filename.txt`
- Создание папки: `mkdir dirname`
- Перемещение файла: `move filename.txt C:\path\to\destination\`
- Копирование файла: `copy filename.txt C:\path\to\destination\`
- Удаление файла: `del filename.txt`
- Удаление папки: `rmdir /s /q dirname`

### Сетевые команды

#### Linux (shell)
- Проверка подключения (ping): `ping www.example.com`
- Получение IP-адреса: `ifconfig` или `ip a`
- Трассировка маршрута: `traceroute www.example.com`
- Проверка открытых портов: `netstat -tuln`

#### Windows (cmd)
- Проверка подключения (ping): `ping www.example.com`
- Получение IP-адреса: `ipconfig`
- Трассировка маршрута: `tracert www.example.com`
- Проверка открытых портов: `netstat -an`



